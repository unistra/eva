{% load i18n %}
<label style="display: inline-block;width:75%" > {% trans "Composantes" %}<span class="asteriskField">*</span>
</label>
<table class = "table table-striped" style="white-space: nowrap" id='degreeTable'>
      <tr>
        <td>
          <select name="select-degreetype" style="width:100%" id='select-cmp'>
          <option selected value="default">{% trans "Ajouter une composante" %}</option>
          {% for e in institutes%}
          <option value="{{e.id}}">
            {{e.code}} - {{e.label}}
          </option>
          {%endfor%}
        </select>
      </td>
      </tr>
   <tbody class="overflow" id='tbodyCmp'>
  {% for e in object.institutes.all%}
  <tr id='row-{{e.id}}'>
     <td style="width: 100%">{{e}}
     </td>
     <td >
      <a id="{{e.id}}" class="glyphicon glyphicon-trash select remove-cmp"></a>
     </td>
  </tr>
  {%endfor%}

   </tbody>

</table>

<style media="screen">
#degreeTable .table{
  width: 22vw;

}
#degreeTable .overflow{
    overflow: auto;
    height: 77px;
    display:block;
  }
 caption{
  padding-top: 0;
}
#degreeTable td{
  width: 100vw;
}
.table>tbody>tr>td {
  padding: 0.2em;
}
</style>

<script type="text/javascript">

var institute_val = $('#id_institutes').val() === null ? [] :  $('#id_institutes').val();
// transform select option to array or dict
var x = document.getElementById('id_institutes');
var dict = []
for (i=0; i < x.length; i++){
  var txt =  x.options[i].text.split(' - ',2);
  dict.push({"val": x.options[i].value, "label": txt[1], "code": txt[0]})
};

$('.remove-cmp').click(function () {
    console.log("jere");
    var _val = $('td:first',$(this).parents('tr')).text();

    var i = institute_val.indexOf(_val);
    if(i != -1) {
      institute_val.splice(i, 1);
    }
    $('#id_institutes').val(institute_val);
    $(this).parents('tr').detach();
  });


$('#select-cmp').on('change', function() {
    var x = document.getElementById("select-cmp");
    var val = this.value;
    var label = this.options[this.selectedIndex].innerHTML;
    if (val != "default"){
        console.log(val);
        x.remove(x.selectedIndex);
        var tbody = document.getElementById('tbodyCmp');
        var row = tbody.insertRow(0);
        row.id = 'row-' + val
        var cell1 = row.insertCell(0);
        cell1.style.width = '100%'
        var cell2 = row.insertCell(1);
        cell1.innerHTML = label;
        cell2.innerHTML =   '<a id=" '+ val +'" class="glyphicon glyphicon-trash select remove-cmp" ></a>';
    }
    //     success: function(data) {

    //
    // };
});
$('#id_institutes').val(institute_val);
</script>
